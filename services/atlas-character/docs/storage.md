# Storage

## Tables

### characters

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| TenantId | uuid | no | - | Tenant identifier |
| ID | uint32 | no | autoIncrement | Primary key |
| AccountId | uint32 | no | - | Associated account |
| World | world.Id | no | - | World assignment |
| Name | string | no | - | Character name |
| Level | byte | no | 1 | Current level |
| Experience | uint32 | no | 0 | Current experience |
| GachaponExperience | uint32 | no | 0 | Gachapon experience |
| Strength | uint16 | no | 12 | STR stat |
| Dexterity | uint16 | no | 5 | DEX stat |
| Intelligence | uint16 | no | 4 | INT stat |
| Luck | uint16 | no | 4 | LUK stat |
| HP | uint16 | no | 50 | Current HP |
| MP | uint16 | no | 5 | Current MP |
| MaxHP | uint16 | no | 50 | Maximum HP |
| MaxMP | uint16 | no | 5 | Maximum MP |
| Meso | uint32 | no | 0 | Currency |
| HPMPUsed | int | no | 0 | AP spent on HP/MP |
| JobId | job.Id | no | 0 | Current job |
| SkinColor | byte | no | 0 | Skin color |
| Gender | byte | no | 0 | Gender |
| Fame | int16 | no | 0 | Fame points |
| Hair | uint32 | no | 0 | Hair style ID |
| Face | uint32 | no | 0 | Face ID |
| AP | uint16 | no | 0 | Available AP |
| SP | string | no | 0,0,0,0,0,0,0,0,0,0 | Available SP |
| MapId | map.Id | no | 0 | Current map |
| Instance | uuid.UUID | no | 00000000-0000-0000-0000-000000000000 | Map instance |
| SpawnPoint | uint32 | no | 0 | Spawn point ID |
| GM | int | no | 0 | GM level |
| X | int16 | no | 0 | X position |
| Y | int16 | no | 0 | Y position |
| Stance | byte | no | 0 | Current stance |

### session_history

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| ID | uint64 | no | autoIncrement | Primary key |
| TenantId | uuid | no | - | Tenant identifier |
| CharacterId | uint32 | no | - | Character |
| WorldId | world.Id | no | - | World |
| ChannelId | channel.Id | no | - | Channel |
| LoginTime | time.Time | no | - | Login timestamp |
| LogoutTime | *time.Time | yes | null | Logout timestamp |

### saved_locations

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| ID | uuid.UUID | no | - | Primary key |
| TenantId | uuid | no | - | Tenant identifier |
| CharacterId | uint32 | no | - | Character |
| LocationType | string | no | - | Type of saved location |
| MapId | map.Id | no | - | Map |
| PortalId | uint32 | no | - | Portal |

## Relationships

None defined in entities.

## Indexes

### characters
- Primary key on ID column (auto-generated by GORM)

### session_history
- Primary key on ID column (auto-generated by GORM)
- Composite index `idx_session_history_lookup` on (TenantId, CharacterId, LoginTime)

### saved_locations
- Primary key on ID column
- Unique composite index `idx_saved_location_lookup` on (TenantId, CharacterId, LocationType)

## Migration Rules

- Migration performed via GORM AutoMigrate
- Table names: characters, session_history, saved_locations
- Schema changes applied on service startup
