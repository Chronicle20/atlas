{
  "npcId": 2100008,
  "startState": "selectService",
  "states": [
    {
      "id": "selectService",
      "type": "listSelection",
      "listSelection": {
        "title": "Ah, welcome to the Ariant Plastic Surgery! Would you like to transform your face into something new? With a #b#t5152030##k or a #b#t5152047##k, I can make your face so much better!",
        "choices": [
          {
            "text": "Plastic Surgery: #i5152030##t5152030#",
            "nextState": "generateFaceStyles",
            "context": {
              "serviceType": "plasticSurgery"
            }
          },
          {
            "text": "Cosmetic Lens: #i5152047##t5152047#",
            "nextState": "generateFaceColors",
            "context": {
              "serviceType": "cosmeticLens"
            }
          },
          {
            "text": "One-time Cosmetic Lenses: #i5152101# (any color)",
            "nextState": "generateOnetimeLensColors",
            "context": {
              "serviceType": "onetimeLens"
            }
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "generateFaceStyles",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:generate_face_styles",
            "params": {
              "baseStyles": "20000,20004,20005,20012,20013,20031,21000,21003,21006,21009,21012,21024",
              "genderFilter": "true",
              "preserveColor": "true",
              "validateExists": "true",
              "excludeEquipped": "true",
              "outputContextKey": "generatedFaces"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "askFaceStyle"
          }
        ]
      }
    },
    {
      "id": "askFaceStyle",
      "type": "askStyle",
      "askStyle": {
        "text": "Hmmm... Face of beauty glows even under cover and burning desert. Choose the face you want, and I will pull out my outstanding skill for the great make over.",
        "stylesContextKey": "generatedFaces",
        "contextKey": "selectedFace",
        "nextState": "checkPlasticSurgeryCoupon"
      }
    },
    {
      "id": "checkPlasticSurgeryCoupon",
      "type": "genericAction",
      "genericAction": {
        "operations": [],
        "outcomes": [
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152030"
              }
            ],
            "nextState": "applyPlasticSurgery"
          },
          {
            "conditions": [],
            "nextState": "noPlasticSurgeryCoupon"
          }
        ]
      }
    },
    {
      "id": "applyPlasticSurgery",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "destroy_item",
            "params": {
              "itemId": "5152030",
              "quantity": "1"
            }
          },
          {
            "type": "change_face",
            "params": {
              "styleId": "{context.selectedFace}"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "plasticSurgerySuccess"
          }
        ]
      }
    },
    {
      "id": "plasticSurgerySuccess",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Enjoy your new and improved face!",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "noPlasticSurgeryCoupon",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendNext",
        "text": "Erm... You don't seem to have the exclusive coupon for this hospital. Without the coupon, I'm afraid I can't do it for you.",
        "choices": [
          {
            "text": "Next",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "generateFaceColors",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:generate_face_colors",
            "params": {
              "colorOffsets": "0,100,300,600,700",
              "validateExists": "true",
              "excludeEquipped": "true",
              "outputContextKey": "generatedFaceColors"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "askFaceColor"
          }
        ]
      }
    },
    {
      "id": "askFaceColor",
      "type": "askStyle",
      "askStyle": {
        "text": "With the utmost finesse matching that of the sparkling sands of the desert that gleefully embraces the rooftop of the Palace, we will make your eyes shine even brighter with the new lenses. Select the one you want to use...",
        "stylesContextKey": "generatedFaceColors",
        "contextKey": "selectedFace",
        "nextState": "checkCosmeticLensCoupon"
      }
    },
    {
      "id": "checkCosmeticLensCoupon",
      "type": "genericAction",
      "genericAction": {
        "operations": [],
        "outcomes": [
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152047"
              }
            ],
            "nextState": "applyCosmeticLens"
          },
          {
            "conditions": [],
            "nextState": "noCosmeticLensCoupon"
          }
        ]
      }
    },
    {
      "id": "applyCosmeticLens",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "destroy_item",
            "params": {
              "itemId": "5152047",
              "quantity": "1"
            }
          },
          {
            "type": "change_face",
            "params": {
              "styleId": "{context.selectedFace}"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "cosmeticLensSuccess"
          }
        ]
      }
    },
    {
      "id": "cosmeticLensSuccess",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Enjoy your new and improved cosmetic lenses!",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "noCosmeticLensCoupon",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Hmm ... it looks like you don't have the coupon specifically for this place. Sorry to say this, but without the coupon, there's no plastic surgery for you...",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "generateOnetimeLensColors",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:generate_face_colors_for_onetime_lens",
            "params": {
              "validateExists": "true",
              "excludeEquipped": "true",
              "outputContextKey": "onetimeLensColors"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "successState": "askOnetimeLensColor",
            "failureState": "noOnetimeLensItems"
          }
        ]
      }
    },
    {
      "id": "noOnetimeLensItems",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "You don't have any One-Time Cosmetic Lens to use.",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "askOnetimeLensColor",
      "type": "askStyle",
      "askStyle": {
        "text": "What kind of lens would you like to wear? Please choose the style of your liking.",
        "stylesContextKey": "onetimeLensColors",
        "contextKey": "selectedFace",
        "nextState": "calculateOnetimeLensCoupon"
      }
    },
    {
      "id": "calculateOnetimeLensCoupon",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:calculate_lens_coupon",
            "params": {
              "selectedFaceContextKey": "selectedFace",
              "outputContextKey": "lensItemId"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "checkOnetimeLensCoupon"
          }
        ]
      }
    },
    {
      "id": "checkOnetimeLensCoupon",
      "type": "genericAction",
      "genericAction": {
        "operations": [],
        "outcomes": [
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "{context.lensItemId}"
              }
            ],
            "nextState": "applyOnetimeLens"
          },
          {
            "conditions": [],
            "nextState": "noOnetimeLensCoupon"
          }
        ]
      }
    },
    {
      "id": "applyOnetimeLens",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "destroy_item",
            "params": {
              "itemId": "{context.lensItemId}",
              "quantity": "1"
            }
          },
          {
            "type": "change_face",
            "params": {
              "styleId": "{context.selectedFace}"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "onetimeLensSuccess"
          }
        ]
      }
    },
    {
      "id": "onetimeLensSuccess",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Enjoy your new and improved cosmetic lenses!",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "noOnetimeLensCoupon",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "I'm sorry, but I don't think you have our cosmetic lens coupon with you right now. Without the coupon, I'm afraid I can't do it for you..",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    }
  ]
}
