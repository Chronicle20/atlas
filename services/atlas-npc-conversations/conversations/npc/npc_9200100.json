{
  "npcId": 9200100,
  "startState": "mainMenu",
  "states": [
    {
      "id": "mainMenu",
      "type": "listSelection",
      "listSelection": {
        "title": "Hi, there~! I'm Dr. Lenu, in charge of the cosmetic lenses here at the Henesys Plastic Surgery Shop! With #b#t5152010##k or #b#t5152013##k, you can let us take care of the rest and have the kind of beautiful look you've always craved~! Remember, the first thing everyone notices about you is the eyes, and we can help you find the cosmetic lens that most fits you! Now, what would you like to use?",
        "choices": [
          {
            "text": "Cosmetic Lenses: #i5152010##t5152010#",
            "nextState": "generateRegularColors",
            "context": {
              "beautyType": "1"
            }
          },
          {
            "text": "Cosmetic Lenses: #i5152013##t5152013#",
            "nextState": "generateVipColors",
            "context": {
              "beautyType": "2"
            }
          },
          {
            "text": "One-time Cosmetic Lenses: #i5152103# (any color)",
            "nextState": "checkOneTimeLens",
            "context": {
              "beautyType": "3"
            }
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "generateRegularColors",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:generate_hair_colors",
            "params": {
              "colors": "0,1,2,4,6,7",
              "cosmeticType": "face",
              "validateExists": "true",
              "excludeEquipped": "true",
              "outputContextKey": "regularLensColors"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "confirmRegularLens"
          }
        ]
      }
    },
    {
      "id": "confirmRegularLens",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendYesNo",
        "text": "If you use the regular coupon, you'll be awarded a random pair of cosmetic lenses. Are you going to use a #b#t5152010##k and really make the change to your eyes?",
        "choices": [
          {
            "text": "Yes",
            "nextState": "checkRegularCoupon"
          },
          {
            "text": "No",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "checkRegularCoupon",
      "type": "genericAction",
      "genericAction": {
        "operations": [],
        "outcomes": [
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152010"
              }
            ],
            "nextState": "applyRandomLens"
          },
          {
            "conditions": [],
            "nextState": "noRegularCoupon"
          }
        ]
      }
    },
    {
      "id": "applyRandomLens",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:select_random_cosmetic",
            "params": {
              "stylesContextKey": "regularLensColors",
              "outputContextKey": "selectedFace"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "performRegularChange"
          }
        ]
      }
    },
    {
      "id": "performRegularChange",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "destroy_item",
            "params": {
              "itemId": "5152010",
              "quantity": "1"
            }
          },
          {
            "type": "change_face",
            "params": {
              "styleId": "{context.selectedFace}"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "regularLensSuccess"
          }
        ]
      }
    },
    {
      "id": "regularLensSuccess",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Enjoy your new and improved cosmetic lenses!",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "noRegularCoupon",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "I'm sorry, but I don't think you have our cosmetic lens coupon with you right now. Without the coupon, I'm afraid I can't do it for you..",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "generateVipColors",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:generate_hair_colors",
            "params": {
              "colors": "0,1,2,4,6,7",
              "cosmeticType": "face",
              "validateExists": "true",
              "excludeEquipped": "true",
              "outputContextKey": "vipLensColors"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "selectVipLens"
          }
        ]
      }
    },
    {
      "id": "selectVipLens",
      "type": "askStyle",
      "askStyle": {
        "text": "With our specialized machine, you can see yourself after the treatment in advance. What kind of lens would you like to wear? Choose the style of your liking.",
        "stylesContextKey": "vipLensColors",
        "contextKey": "selectedFace",
        "nextState": "checkVipCoupon"
      }
    },
    {
      "id": "checkVipCoupon",
      "type": "genericAction",
      "genericAction": {
        "operations": [],
        "outcomes": [
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152013"
              }
            ],
            "nextState": "applyVipLens"
          },
          {
            "conditions": [],
            "nextState": "noVipCoupon"
          }
        ]
      }
    },
    {
      "id": "applyVipLens",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "destroy_item",
            "params": {
              "itemId": "5152013",
              "quantity": "1"
            }
          },
          {
            "type": "change_face",
            "params": {
              "styleId": "{context.selectedFace}"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "vipLensSuccess"
          }
        ]
      }
    },
    {
      "id": "vipLensSuccess",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Enjoy your new and improved cosmetic lenses!",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "noVipCoupon",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "I'm sorry, but I don't think you have our cosmetic lens coupon with you right now. Without the coupon, I'm afraid I can't do it for you..",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "checkOneTimeLens",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:generate_hair_colors",
            "params": {
              "colors": "0,1,2,3,4,5,6,7",
              "cosmeticType": "face",
              "validateExists": "true",
              "excludeEquipped": "true",
              "requireItems": "5152100,5152101,5152102,5152103,5152104,5152105,5152106,5152107",
              "outputContextKey": "oneTimeLensColors"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "checkOneTimeLensAvailable"
          }
        ]
      }
    },
    {
      "id": "checkOneTimeLensAvailable",
      "type": "genericAction",
      "genericAction": {
        "operations": [],
        "outcomes": [
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152100"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152101"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152102"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152103"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152104"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152105"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152106"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152107"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [],
            "nextState": "noOneTimeLens"
          }
        ]
      }
    },
    {
      "id": "noOneTimeLens",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "You don't have any One-Time Cosmetic Lens to use.",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "selectOneTimeLens",
      "type": "askStyle",
      "askStyle": {
        "text": "What kind of lens would you like to wear? Please choose the style of your liking.",
        "stylesContextKey": "oneTimeLensColors",
        "contextKey": "selectedFace",
        "nextState": "applyOneTimeLens"
      }
    },
    {
      "id": "applyOneTimeLens",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:calculate_lens_coupon",
            "params": {
              "selectedFaceContextKey": "selectedFace",
              "outputContextKey": "lensItemId"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "checkAndApplyOneTimeLens"
          }
        ]
      }
    },
    {
      "id": "checkAndApplyOneTimeLens",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "destroy_item",
            "params": {
              "itemId": "{context.lensItemId}",
              "quantity": "1"
            }
          },
          {
            "type": "change_face",
            "params": {
              "styleId": "{context.selectedFace}"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "oneTimeLensSuccess"
          }
        ]
      }
    },
    {
      "id": "oneTimeLensSuccess",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Enjoy your new and improved cosmetic lenses!",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    }
  ]
}
