{
  "npcId": 9201062,
  "startState": "mainMenu",
  "states": [
    {
      "id": "mainMenu",
      "type": "listSelection",
      "listSelection": {
        "title": "Hey, there~! I'm J.J.! I'm in charge of the cosmetic lenses here at NLC Shop! If you have a #b#t5152036##k, I can get you the best cosmetic lenses you have ever had! Now, what would you like to do?",
        "choices": [
          {
            "text": "Cosmetic Lenses: #i5152036##t5152036#",
            "nextState": "generateVipColors",
            "context": {
              "beautyType": "2"
            }
          },
          {
            "text": "One-time Cosmetic Lenses: #i5152107# (any color)",
            "nextState": "checkOneTimeLens",
            "context": {
              "beautyType": "3"
            }
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "generateVipColors",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:generate_face_colors",
            "params": {
              "colorOffsets": "100,200,300,400,500,600,700",
              "validateExists": "true",
              "excludeEquipped": "true",
              "outputContextKey": "vipLensColors"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "selectVipLens"
          }
        ]
      }
    },
    {
      "id": "selectVipLens",
      "type": "askStyle",
      "askStyle": {
        "text": "With our specialized machine, you can see yourself after the treatment in advance. What kind of lens would you like to wear? Choose the style of your liking.",
        "stylesContextKey": "vipLensColors",
        "contextKey": "selectedFace",
        "nextState": "checkVipCoupon"
      }
    },
    {
      "id": "checkVipCoupon",
      "type": "genericAction",
      "genericAction": {
        "operations": [],
        "outcomes": [
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152036"
              }
            ],
            "nextState": "applyVipLens"
          },
          {
            "conditions": [],
            "nextState": "noVipCoupon"
          }
        ]
      }
    },
    {
      "id": "applyVipLens",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "destroy_item",
            "params": {
              "itemId": "5152036",
              "quantity": "1"
            }
          },
          {
            "type": "change_face",
            "params": {
              "styleId": "{context.selectedFace}"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "vipLensSuccess"
          }
        ]
      }
    },
    {
      "id": "vipLensSuccess",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Enjoy your new and improved cosmetic lenses!",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "noVipCoupon",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "I'm sorry, but I don't think you have our cosmetic lens coupon with you right now. Without the coupon, I'm afraid I can't do it for you..",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "checkOneTimeLens",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:generate_face_colors",
            "params": {
              "colorOffsets": "0,100,200,300,400,500,600,700",
              "validateExists": "true",
              "excludeEquipped": "true",
              "requireItems": "5152100,5152101,5152102,5152103,5152104,5152105,5152106,5152107",
              "outputContextKey": "oneTimeLensColors"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "checkOneTimeLensAvailable"
          }
        ]
      }
    },
    {
      "id": "checkOneTimeLensAvailable",
      "type": "genericAction",
      "genericAction": {
        "operations": [],
        "outcomes": [
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152100"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152101"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152102"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152103"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152104"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152105"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152106"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5152107"
              }
            ],
            "nextState": "selectOneTimeLens"
          },
          {
            "conditions": [],
            "nextState": "noOneTimeLens"
          }
        ]
      }
    },
    {
      "id": "noOneTimeLens",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "You don't have any One-Time Cosmetic Lens to use.",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "selectOneTimeLens",
      "type": "askStyle",
      "askStyle": {
        "text": "What kind of lens would you like to wear? Please choose the style of your liking.",
        "stylesContextKey": "oneTimeLensColors",
        "contextKey": "selectedFace",
        "nextState": "applyOneTimeLens"
      }
    },
    {
      "id": "applyOneTimeLens",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:calculate_lens_coupon",
            "params": {
              "selectedFaceContextKey": "selectedFace",
              "outputContextKey": "lensItemId"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "checkAndApplyOneTimeLens"
          }
        ]
      }
    },
    {
      "id": "checkAndApplyOneTimeLens",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "destroy_item",
            "params": {
              "itemId": "{context.lensItemId}",
              "quantity": "1"
            }
          },
          {
            "type": "change_face",
            "params": {
              "styleId": "{context.selectedFace}"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "oneTimeLensSuccess"
          }
        ]
      }
    },
    {
      "id": "oneTimeLensSuccess",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Enjoy your new and improved cosmetic lenses!",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    }
  ]
}
