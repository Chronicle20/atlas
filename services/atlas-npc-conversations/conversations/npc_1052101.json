{
  "npcId": 1052101,
  "startState": "selectService",
  "states": [
    {
      "id": "selectService",
      "type": "listSelection",
      "listSelection": {
        "title": "I'm Andre, Don's assistant. Everyone calls me Andre, though. If you have a #b#t5150002##k, #b#t5150011##k or a #b#t5151002##k, please let me change your hairdo!",
        "choices": [
          {
            "text": "Haircut: #i5150002##t5150002#",
            "nextState": "confirmRegCoupon",
            "context": {
              "couponType": "reg",
              "couponId": "5150002"
            }
          },
          {
            "text": "Haircut: #i5150011##t5150011#",
            "nextState": "confirmExpCoupon",
            "context": {
              "couponType": "exp",
              "couponId": "5150011"
            }
          },
          {
            "text": "Dye your hair: #i5151002##t5151002#",
            "nextState": "confirmDyeCoupon",
            "context": {
              "couponType": "dye",
              "couponId": "5151002"
            }
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "confirmRegCoupon",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendYesNo",
        "text": "If you use the REG coupon your hair will change RANDOMLY with a chance to obtain a new experimental style that I came up with. Are you going to use #b#t5150011##k and really change your hairstyle?",
        "choices": [
          {
            "text": "Yes",
            "nextState": "checkRegCoupon"
          },
          {
            "text": "No",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "confirmExpCoupon",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendYesNo",
        "text": "If you use the EXP coupon your hair will change RANDOMLY with a chance to obtain a new experimental style that I came up with. Are you going to use #b#t5150011##k and really change your hairstyle?",
        "choices": [
          {
            "text": "Yes",
            "nextState": "checkExpCoupon"
          },
          {
            "text": "No",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "confirmDyeCoupon",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendYesNo",
        "text": "If you use a regular coupon your hair will change RANDOMLY. Do you still want to use #b#t5151002##k and change it up?",
        "choices": [
          {
            "text": "Yes",
            "nextState": "checkDyeCoupon"
          },
          {
            "text": "No",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "checkRegCoupon",
      "type": "genericAction",
      "genericAction": {
        "operations": [],
        "outcomes": [
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5150002"
              }
            ],
            "nextState": "generateRegHairStyles"
          },
          {
            "conditions": [],
            "nextState": "noCouponHaircut"
          }
        ]
      }
    },
    {
      "id": "checkExpCoupon",
      "type": "genericAction",
      "genericAction": {
        "operations": [],
        "outcomes": [
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5150011"
              }
            ],
            "nextState": "generateExpHairStyles"
          },
          {
            "conditions": [],
            "nextState": "noCouponHaircut"
          }
        ]
      }
    },
    {
      "id": "checkDyeCoupon",
      "type": "genericAction",
      "genericAction": {
        "operations": [],
        "outcomes": [
          {
            "conditions": [
              {
                "type": "item",
                "operator": ">=",
                "value": "1",
                "referenceId": "5151002"
              }
            ],
            "nextState": "generateHairColors"
          },
          {
            "conditions": [],
            "nextState": "noCouponDye"
          }
        ]
      }
    },
    {
      "id": "generateRegHairStyles",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:generate_hair_styles",
            "params": {
              "baseStyles": "30040,30130,30520,30770,30780,30850,30920,33040,31060,31140,31330,31440,31520,31750,31760,31880,34050",
              "genderFilter": "true",
              "preserveColor": "true",
              "validateExists": "true",
              "excludeEquipped": "true",
              "outputContextKey": "availableHairs"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "selectRandomRegHair"
          }
        ]
      }
    },
    {
      "id": "generateExpHairStyles",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:generate_hair_styles",
            "params": {
              "baseStyles": "30130,30430,30520,30770,30780,30850,30920,33040,31060,31140,31330,31520,31760,31880,34010,34050",
              "genderFilter": "true",
              "preserveColor": "true",
              "validateExists": "true",
              "excludeEquipped": "true",
              "outputContextKey": "availableHairs"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "selectRandomExpHair"
          }
        ]
      }
    },
    {
      "id": "generateHairColors",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:generate_hair_colors",
            "params": {
              "colors": "0,1,2,3,4,5,6,7",
              "validateExists": "true",
              "excludeEquipped": "true",
              "outputContextKey": "availableColors"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "selectRandomColor"
          }
        ]
      }
    },
    {
      "id": "selectRandomRegHair",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:select_random_cosmetic",
            "params": {
              "stylesContextKey": "availableHairs",
              "outputContextKey": "selectedHair"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "applyRegHairChange"
          }
        ]
      }
    },
    {
      "id": "selectRandomExpHair",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:select_random_cosmetic",
            "params": {
              "stylesContextKey": "availableHairs",
              "outputContextKey": "selectedHair"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "applyExpHairChange"
          }
        ]
      }
    },
    {
      "id": "selectRandomColor",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "local:select_random_cosmetic",
            "params": {
              "stylesContextKey": "availableColors",
              "outputContextKey": "selectedHair"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "applyColorChange"
          }
        ]
      }
    },
    {
      "id": "applyRegHairChange",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "destroy_item",
            "params": {
              "itemId": "5150002",
              "quantity": "1"
            }
          },
          {
            "type": "change_hair",
            "params": {
              "styleId": "{context.selectedHair}"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "successHaircut"
          }
        ]
      }
    },
    {
      "id": "applyExpHairChange",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "destroy_item",
            "params": {
              "itemId": "5150011",
              "quantity": "1"
            }
          },
          {
            "type": "change_hair",
            "params": {
              "styleId": "{context.selectedHair}"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "successHaircut"
          }
        ]
      }
    },
    {
      "id": "applyColorChange",
      "type": "genericAction",
      "genericAction": {
        "operations": [
          {
            "type": "destroy_item",
            "params": {
              "itemId": "5151002",
              "quantity": "1"
            }
          },
          {
            "type": "change_hair",
            "params": {
              "styleId": "{context.selectedHair}"
            }
          }
        ],
        "outcomes": [
          {
            "conditions": [],
            "nextState": "successDye"
          }
        ]
      }
    },
    {
      "id": "successHaircut",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Enjoy your new and improved hairstyle!",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "successDye",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Enjoy your new and improved haircolor!",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "noCouponHaircut",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Hmmm...it looks like you don't have our designated coupon...I'm afraid I can't give you a haircut without it. I'm sorry...",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    },
    {
      "id": "noCouponDye",
      "type": "dialogue",
      "dialogue": {
        "dialogueType": "sendOk",
        "text": "Hmmm...it looks like you don't have our designated coupon...I'm afraid I can't dye your hair without it. I'm sorry...",
        "choices": [
          {
            "text": "Ok",
            "nextState": null
          },
          {
            "text": "Exit",
            "nextState": null
          }
        ]
      }
    }
  ]
}
