{
  "questId": 21011,
  "npcId": 1201000,
  "questName": "Lilin's Request",
  "startStateMachine": {
    "startState": "intro",
    "states": [
      {
        "id": "intro",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNext",
          "text": "Wait, are you... No way.... Are you the hero that #p1201000# has been talking about all this time?! #p1201000#! Don't just nod... Tell me! Is this the hero you've been waiting for?! ",
          "choices": [
            {"text": "Next", "nextState": "itemIcon"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "itemIcon",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNextPrev",
          "text": "   #i4001171#",
          "choices": [
            {"text": "Previous", "nextState": "intro"},
            {"text": "Next", "nextState": "emotions"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "emotions",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNextPrev",
          "text": "I'm sorry. I'm just so overcome with emotions... *Sniff sniff* My goodness, I'm starting to tear up. You must be so happy, #p1201000#.",
          "choices": [
            {"text": "Previous", "nextState": "itemIcon"},
            {"text": "Next", "nextState": "askAccept"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "askAccept",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendAcceptDecline",
          "text": "Wait a minute... You're not carrying any weapons. From what I've heard, each of the heroes had a special weapon. Oh, you must have lost it during the battle against the Black Mage.",
          "choices": [
            {"text": "Accept", "nextState": "startQuest"},
            {"text": "Decline", "nextState": "decline"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "decline",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendOk",
          "text": "Ah, okay. I understand. Heroes are very busy. *Sniff...* If you ever get any free time, though...",
          "choices": [
            {"text": "Ok", "nextState": null},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "startQuest",
        "type": "genericAction",
        "genericAction": {
          "operations": [
            {"type": "start_quest", "params": {}}
          ],
          "outcomes": [
            {"conditions": [], "nextState": "confirm"}
          ]
        }
      },
      {
        "id": "confirm",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendOk",
          "text": "My brother #bPuir #kis just down the street, and he's been dying to meet you! I know you're busy, but could you please stop by and say hello to Puir? Please...",
          "choices": [
            {"text": "Ok", "nextState": null},
            {"text": "Exit", "nextState": null}
          ]
        }
      }
    ]
  },
  "endStateMachine": {
    "startState": "puirIntro",
    "states": [
      {
        "id": "puirIntro",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNext",
          "text": "Wait, are you... No way... Are you the hero that Lilin has been talking about all this time?! Lilin! Don't just nod... Tell me! Is this the hero you've been waiting for?!",
          "choices": [
            {"text": "Next", "nextState": "puirItemIcon"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "puirItemIcon",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNextPrev",
          "text": "#i4001171#",
          "choices": [
            {"text": "Previous", "nextState": "puirIntro"},
            {"text": "Next", "nextState": "puirEmotions"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "puirEmotions",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNextPrev",
          "text": "I'm sorry. I'm just so overcome with emotions... *Sniff sniff* My goodness, I'm starting to tear up. You must be so happy, Lilin.",
          "choices": [
            {"text": "Previous", "nextState": "puirItemIcon"},
            {"text": "Next", "nextState": "puirWeapon"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "puirWeapon",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNextPrev",
          "text": "Wait a minute... You're not carrying any weapons. From what I've hear, each of the heroes had a special weapon. Oh, you must have lost it during the battle against the Black Mage.",
          "choices": [
            {"text": "Previous", "nextState": "puirEmotions"},
            {"text": "Next", "nextState": "offerReward"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "offerReward",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendYesNo",
          "text": "This isn't good enough to replace your weapon, but #bcarry this sword with you for now#k. It's my gift to you. A hero can't be walking around empty-handed.\r\n\r\n#fUI/UIWindow.img/QuestIcon/4/0#\r\n#v1302000# 1 #t1302000#\r\n\r\n#fUI/UIWindow.img/QuestIcon/8/0# 35 exp",
          "choices": [
            {"text": "Yes", "nextState": "checkInventory"},
            {"text": "No", "nextState": "declineReward"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "declineReward",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNext",
          "text": "*sniff sniff* Isn't this sword good enough for you, just for now? I'd be so honored...",
          "choices": [
            {"text": "Next", "nextState": null},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "checkInventory",
        "type": "genericAction",
        "genericAction": {
          "operations": [],
          "outcomes": [
            {
              "conditions": [
                {"type": "questStatus", "operator": "=", "value": "2", "referenceId": "21011"}
              ],
              "nextState": "alreadyCompleted"
            },
            {
              "conditions": [
                {"type": "inventorySpace", "operator": ">=", "value": "1", "referenceId": "1302000"}
              ],
              "nextState": "giveReward"
            },
            {
              "conditions": [],
              "nextState": "inventoryFull"
            }
          ]
        }
      },
      {
        "id": "alreadyCompleted",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendOk",
          "text": "Unknown Error",
          "choices": [
            {"text": "Ok", "nextState": null},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "inventoryFull",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendOk",
          "text": "Your inventory is full",
          "choices": [
            {"text": "Ok", "nextState": null},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "giveReward",
        "type": "genericAction",
        "genericAction": {
          "operations": [
            {"type": "award_item", "params": {"itemId": "1302000", "quantity": "1"}},
            {"type": "award_exp", "params": {"amount": "35"}},
            {"type": "complete_quest", "params": {}}
          ],
          "outcomes": [
            {"conditions": [], "nextState": "heroThoughts"}
          ]
        }
      },
      {
        "id": "heroThoughts",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNext",
          "text": "#b(Your skills are nowhere close to being hero-like... But a sword? Have you ever even held a sword in your lifetime? You can't remember... How do you even equip it?)",
          "speaker": "CHARACTER_LEFT",
          "choices": [
            {"text": "Next", "nextState": null},
            {"text": "Exit", "nextState": null}
          ]
        }
      }
    ]
  }
}
