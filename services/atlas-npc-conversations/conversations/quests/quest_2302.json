{
  "questId": 2302,
  "questName": "Kingdom of Mushroom in Danger",
  "startStateMachine": {
    "startState": "askAccept",
    "states": [
      {
        "id": "askAccept",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendAcceptDecline",
          "text": "Now that you have made the job advancement, you look like you're ready for this. I have something I'd like to ask you for help. Are you willing to listen?",
          "choices": [
            {"text": "Accept", "nextState": "explainSituation"},
            {"text": "Decline", "nextState": "declineResponse"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "declineResponse",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendOk",
          "text": "Really? It's an urgent matter, so if you have some time, please see me.",
          "choices": [
            {"text": "Ok", "nextState": null},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "explainSituation",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNext",
          "text": "What happened is that the #bKingdom of Mushroom#k is currently in disarray. Kingdom of Mushroom is located near Henesys, featuring the peace-loving, intelligent King Mush. Recently, he began to feel ill, so he decided to appoint his only daughter #bPrincess Violetta#k. Something must have happened since then for the kingdom to be in its current state.",
          "choices": [
            {"text": "Next", "nextState": "explainLetter"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "explainLetter",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNext",
          "text": "I am not aware of the exact details, but it's obvious something terrible had taken place, so I think it'll be better if you go there and assess the damage yourself. An explorer like you seem more than capable of saving Kingdom of Mushroom. I have just written you a #brecommendation letter#k, so I suggest you head over to Kingdom of Mushroom immediately and look for the #bHead Patrol Officer#k.\r\n\r\n#fUI/UIWindow.img/QuestIcon/4/0#\r\n#v4032375# #t4032375#",
          "choices": [
            {"text": "Next", "nextState": "askWarp"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "askWarp",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendYesNo",
          "text": "By the way, do you know where Kingdom of Mushroom is located? It'll be okay if you can find your way there, but if you don't mind, I can take you straight to the entrance.",
          "choices": [
            {"text": "Yes", "nextState": "checkInventoryForWarp"},
            {"text": "No", "nextState": "checkInventoryForDirections"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "checkInventoryForWarp",
        "type": "genericAction",
        "genericAction": {
          "operations": [],
          "outcomes": [
            {
              "conditions": [
                {"type": "inventorySpace", "operator": ">=", "value": "1", "referenceId": "4032375"}
              ],
              "nextState": "giveItemAndWarp"
            },
            {
              "conditions": [],
              "nextState": "inventoryFullWarp"
            }
          ]
        }
      },
      {
        "id": "inventoryFullWarp",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendOk",
          "text": "Please have a slot available in your Etc inventory.",
          "choices": [
            {"text": "Ok", "nextState": null},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "giveItemAndWarp",
        "type": "genericAction",
        "genericAction": {
          "operations": [
            {"type": "award_item", "params": {"itemId": "4032375", "quantity": "1"}},
            {"type": "warp_to_map", "params": {"mapId": "106020000", "portalId": "0"}},
            {"type": "start_quest", "params": {}}
          ],
          "outcomes": [
            {"conditions": [], "nextState": null}
          ]
        }
      },
      {
        "id": "checkInventoryForDirections",
        "type": "genericAction",
        "genericAction": {
          "operations": [],
          "outcomes": [
            {
              "conditions": [
                {"type": "inventorySpace", "operator": ">=", "value": "1", "referenceId": "4032375"}
              ],
              "nextState": "giveDirections"
            },
            {
              "conditions": [],
              "nextState": "inventoryFullDirections"
            }
          ]
        }
      },
      {
        "id": "inventoryFullDirections",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendOk",
          "text": "Please have a slot available in your Etc inventory.",
          "choices": [
            {"text": "Ok", "nextState": null},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "giveDirections",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNext",
          "text": "Okay. In that case, I'll just give you the routes to the Kingdom of Mushroom. #bNear the west entrance of Henesys,#k you'll find an #bempty house#k. Enter the house, and turn left to enter#b<Themed Dungeon : Mushroom Castle>#k. That's the entrance to the Kingdom of Mushroom. There's not much time!",
          "choices": [
            {"text": "Next", "nextState": "giveItemOnly"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "giveItemOnly",
        "type": "genericAction",
        "genericAction": {
          "operations": [
            {"type": "award_item", "params": {"itemId": "4032375", "quantity": "1"}},
            {"type": "start_quest", "params": {}}
          ],
          "outcomes": [
            {"conditions": [], "nextState": null}
          ]
        }
      }
    ]
  },
  "endStateMachine": {
    "startState": "checkItem",
    "states": [
      {
        "id": "checkItem",
        "type": "genericAction",
        "genericAction": {
          "operations": [],
          "outcomes": [
            {
              "conditions": [
                {"type": "item", "operator": ">=", "value": "1", "referenceId": "4032375"}
              ],
              "nextState": "hasLetter"
            },
            {
              "conditions": [],
              "nextState": "noLetter"
            }
          ]
        }
      },
      {
        "id": "noLetter",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNext",
          "text": "What do you want, hmmm?",
          "choices": [
            {"text": "Next", "nextState": null},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "hasLetter",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNext",
          "text": "Hmmm? Is that a #brecommendation letter from the job instructor#k??! What is this, are you the one that came to save us, the Kingdom of Mushroom?",
          "choices": [
            {"text": "Next", "nextState": "introduction"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "introduction",
        "type": "dialogue",
        "dialogue": {
          "dialogueType": "sendNextPrev",
          "text": "Hmmm... okay. Since the letter is from the job instructor, I suppose you are really the one. I apologize for not introducing myself to you earlier. I'm the #bHead Security Officer#k in charge of protecting King Mush. As you can see, this temporary hideout is protected by the team of security and soldiers. Our situation may be dire, but nevertheless, welcome to Kingdom of Mushroom.",
          "choices": [
            {"text": "Previous", "nextState": "hasLetter"},
            {"text": "Next", "nextState": "completeQuest"},
            {"text": "Exit", "nextState": null}
          ]
        }
      },
      {
        "id": "completeQuest",
        "type": "genericAction",
        "genericAction": {
          "operations": [
            {"type": "destroy_item", "params": {"itemId": "4032375", "quantity": "1"}},
            {"type": "award_exp", "params": {"amount": "6000"}},
            {"type": "complete_quest", "params": {}},
            {"type": "start_quest", "params": {"questId": "2312"}}
          ],
          "outcomes": [
            {"conditions": [], "nextState": null}
          ]
        }
      }
    ]
  }
}
